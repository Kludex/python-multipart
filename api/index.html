
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A streaming multipart parser for Python.">
      
      
        <meta name="author" content="Marcelo Trylesinski,Andrew Dunham">
      
      
        <link rel="canonical" href="https://kludex.github.io/python-multipart/api/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../changelog/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>API Reference - Python Multipart</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#python_multipart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Python Multipart" class="md-header__button md-logo" aria-label="Python Multipart" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Multipart
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com//kludex/python-multipart" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    kludex/python-multipart
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Python Multipart" class="md-nav__button md-logo" aria-label="Python Multipart" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Python Multipart
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com//kludex/python-multipart" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    kludex/python-multipart
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#python_multipart" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;python_multipart
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.set_callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_callback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" set_callback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.set_callback(name)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.set_callback(new_func)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;new_func
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FormParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FormParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser.close" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;close
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultipartParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MultipartParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OctetStreamParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" OctetStreamParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QuerystringParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" QuerystringParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.create_form_parser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_form_parser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.parse_form" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parse_form
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;exceptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart.exceptions-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.DecodeError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DecodeError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.FileError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FileError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.FormParserError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FormParserError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.MultipartParseError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultipartParseError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.ParseError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParseError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.QuerystringParseError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QuerystringParseError
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#python_multipart" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;python_multipart
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" BaseParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.set_callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_callback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" set_callback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.set_callback(name)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.BaseParser.set_callback(new_func)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;new_func
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FormParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FormParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser.close" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;close
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.FormParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultipartParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" MultipartParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.MultipartParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;OctetStreamParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" OctetStreamParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.OctetStreamParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QuerystringParser
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" QuerystringParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.QuerystringParser.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.create_form_parser" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_form_parser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.parse_form" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parse_form
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;exceptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python_multipart.exceptions-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.DecodeError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DecodeError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.FileError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FileError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.FormParserError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FormParserError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.MultipartParseError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MultipartParseError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.ParseError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParseError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python_multipart.exceptions.QuerystringParseError" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;QuerystringParseError
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>API Reference</h1>

<div class="doc doc-object doc-module">



<a id="python_multipart"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">







<h2 id="python_multipart-classes">Classes<a href="#python_multipart-classes" class="headerlink" title="Permanent link">&para;</a></h2>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.BaseParser" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>BaseParser</code>


<a href="#python_multipart.BaseParser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



        <p>This class is the base class for all parsers.  It contains the logic for
calling and adding callbacks.</p>
<p>A callback can be one of two different forms.  "Notification callbacks" are
callbacks that are called when something happens - for example, when a new
part of a multipart message is encountered by the parser.  "Data callbacks"
are called when we get some sort of data - for example, part of the body of
a multipart chunk.  Notification callbacks are called with no parameters,
whereas data callbacks are called with three, as follows::</p>
<div class="highlight"><pre><span></span><code>data_callback(data, start, end)
</code></pre></div>
<p>The "data" parameter is a bytestring (i.e. "foo" on Python 2, or b"foo" on
Python 3).  "start" and "end" are integer indexes into the "data" string
that represent the data of interest.  Thus, in a data callback, the slice
<code>data[start:end]</code> represents the data that the callback is "interested in".
The callback is not passed a copy of the data, since copying severely hurts
performance.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/multipart.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseParser</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is the base class for all parsers.  It contains the logic for</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    calling and adding callbacks.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    A callback can be one of two different forms.  &quot;Notification callbacks&quot; are</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    callbacks that are called when something happens - for example, when a new</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    part of a multipart message is encountered by the parser.  &quot;Data callbacks&quot;</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    are called when we get some sort of data - for example, part of the body of</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    a multipart chunk.  Notification callbacks are called with no parameters,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    whereas data callbacks are called with three, as follows::</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        data_callback(data, start, end)</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    The &quot;data&quot; parameter is a bytestring (i.e. &quot;foo&quot; on Python 2, or b&quot;foo&quot; on</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    Python 3).  &quot;start&quot; and &quot;end&quot; are integer indexes into the &quot;data&quot; string</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    that represent the data of interest.  Thus, in a data callback, the slice</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">    `data[start:end]` represents the data that the callback is &quot;interested in&quot;.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">    The callback is not passed a copy of the data, since copying severely hurts</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">    performance.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span> <span class="n">QuerystringCallbacks</span> <span class="o">|</span> <span class="n">OctetStreamCallbacks</span> <span class="o">|</span> <span class="n">MultipartCallbacks</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">CallbackName</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This function calls a provided callback with some data.  If the</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">        callback is not set, will do nothing.</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">            name: The name of the callback to call (as a string).</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">            data: Data to pass to the callback.  If None, then it is assumed that the callback is a notification</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">                callback, and no parameters are given.</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">            end: An integer that is passed to the data callback.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">            start: An integer that is passed to the data callback.</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">on_name</span> <span class="o">=</span> <span class="s2">&quot;on_&quot;</span> <span class="o">+</span> <span class="n">name</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">on_name</span><span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="k">return</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Callable[..., Any]&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="c1"># Depending on whether we&#39;re given a buffer...</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="c1"># Don&#39;t do anything if we have start == end.</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="k">return</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calling </span><span class="si">%s</span><span class="s2"> with data[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">on_name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="n">func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calling </span><span class="si">%s</span><span class="s2"> with no data&quot;</span><span class="p">,</span> <span class="n">on_name</span><span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="n">func</span><span class="p">()</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">CallbackName</span><span class="p">,</span> <span class="n">new_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the function for a callback.  Removes from the callbacks dict</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        if new_func is None.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">        :param name: The name of the callback to call (as a string).</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        :param new_func: The new function for the callback.  If None, then the</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">                         callback will be removed (with no error if it does not</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">                         exist).</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="k">if</span> <span class="n">new_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;on_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="s2">&quot;on_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_func</span>  <span class="c1"># type: ignore[literal-required]</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="k">pass</span>  <span class="c1"># pragma: no cover</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="k">pass</span>  <span class="c1"># pragma: no cover</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="python_multipart.BaseParser-functions">Functions<a href="#python_multipart.BaseParser-functions" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.BaseParser.callback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#python_multipart.BaseParser.callback" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>This function calls a provided callback with some data.  If the
callback is not set, will do nothing.</p>
<p>Args:
    name: The name of the callback to call (as a string).
    data: Data to pass to the callback.  If None, then it is assumed that the callback is a notification
        callback, and no parameters are given.
    end: An integer that is passed to the data callback.
    start: An integer that is passed to the data callback.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">CallbackName</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function calls a provided callback with some data.  If the</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">    callback is not set, will do nothing.</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">        name: The name of the callback to call (as a string).</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">        data: Data to pass to the callback.  If None, then it is assumed that the callback is a notification</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">            callback, and no parameters are given.</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">        end: An integer that is passed to the data callback.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">        start: An integer that is passed to the data callback.</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">on_name</span> <span class="o">=</span> <span class="s2">&quot;on_&quot;</span> <span class="o">+</span> <span class="n">name</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">on_name</span><span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="k">return</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Callable[..., Any]&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="c1"># Depending on whether we&#39;re given a buffer...</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="c1"># Don&#39;t do anything if we have start == end.</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="k">return</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calling </span><span class="si">%s</span><span class="s2"> with data[</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">on_name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="n">func</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calling </span><span class="si">%s</span><span class="s2"> with no data&quot;</span><span class="p">,</span> <span class="n">on_name</span><span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">func</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.BaseParser.set_callback" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">set_callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">new_func</span><span class="p">)</span></code>

<a href="#python_multipart.BaseParser.set_callback" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Update the function for a callback.  Removes from the callbacks dict
if new_func is None.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h6 id="python_multipart.BaseParser.set_callback(name)" class="doc doc-heading doc-heading-parameter">                  <code>name</code>
<a href="#python_multipart.BaseParser.set_callback(name)" class="headerlink" title="Permanent link">&para;</a></h6>            </td>
            <td>
                  <code><span title="python_multipart.multipart.CallbackName">CallbackName</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the callback to call (as a string).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h6 id="python_multipart.BaseParser.set_callback(new_func)" class="doc doc-heading doc-heading-parameter">                  <code>new_func</code>
<a href="#python_multipart.BaseParser.set_callback(new_func)" class="headerlink" title="Permanent link">&para;</a></h6>            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[..., <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new function for the callback.  If None, then the callback will be removed (with no error if it does not exist).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">CallbackName</span><span class="p">,</span> <span class="n">new_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the function for a callback.  Removes from the callbacks dict</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    if new_func is None.</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    :param name: The name of the callback to call (as a string).</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    :param new_func: The new function for the callback.  If None, then the</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">                     callback will be removed (with no error if it does not</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">                     exist).</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="k">if</span> <span class="n">new_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;on_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="s2">&quot;on_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_func</span>  <span class="c1"># type: ignore[literal-required]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.FormParser" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>FormParser</code>


<a href="#python_multipart.FormParser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



        <p>This class is the all-in-one form parser.  Given all the information
necessary to parse a form, it will instantiate the correct parser, create
the proper :class:<code>Field</code> and :class:<code>File</code> classes to store the data that
is parsed, and call the two given callbacks with each field and file as
they become available.</p>
<p>Args:
    content_type: The Content-Type of the incoming request.  This is used to select the appropriate parser.
    on_field: The callback to call when a field has been parsed and is ready for usage.  See above for parameters.
    on_file: The callback to call when a file has been parsed and is ready for usage.  See above for parameters.
    on_end: An optional callback to call when all fields and files in a request has been parsed.  Can be None.
    boundary: If the request is a multipart/form-data request, this should be the boundary of the request, as given
        in the Content-Type header, as a bytestring.
    file_name: If the request is of type application/octet-stream, then the body of the request will not contain any
        information about the uploaded file.  In such cases, you can provide the file name of the uploaded file
        manually.
    FileClass: The class to use for uploaded files.  Defaults to :class:<code>File</code>, but you can provide your own class
        if you wish to customize behaviour.  The class will be instantiated as FileClass(file_name, field_name), and
        it must provide the following functions::
            - file_instance.write(data)
            - file_instance.finalize()
            - file_instance.close()
    FieldClass: The class to use for uploaded fields.  Defaults to :class:<code>Field</code>, but you can provide your own
        class if you wish to customize behaviour.  The class will be instantiated as FieldClass(field_name), and it
        must provide the following functions::
            - field_instance.write(data)
            - field_instance.finalize()
            - field_instance.close()
            - field_instance.set_none()
    config: Configuration to use for this FormParser.  The default values are taken from the DEFAULT_CONFIG value,
        and then any keys present in this dictionary will overwrite the default values.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/multipart.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="k">class</span><span class="w"> </span><span class="nc">FormParser</span><span class="p">:</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is the all-in-one form parser.  Given all the information</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">    necessary to parse a form, it will instantiate the correct parser, create</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">    the proper :class:`Field` and :class:`File` classes to store the data that</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">    is parsed, and call the two given callbacks with each field and file as</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">    they become available.</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">        content_type: The Content-Type of the incoming request.  This is used to select the appropriate parser.</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        on_field: The callback to call when a field has been parsed and is ready for usage.  See above for parameters.</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="sd">        on_file: The callback to call when a file has been parsed and is ready for usage.  See above for parameters.</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">        on_end: An optional callback to call when all fields and files in a request has been parsed.  Can be None.</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">        boundary: If the request is a multipart/form-data request, this should be the boundary of the request, as given</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">            in the Content-Type header, as a bytestring.</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">        file_name: If the request is of type application/octet-stream, then the body of the request will not contain any</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">            information about the uploaded file.  In such cases, you can provide the file name of the uploaded file</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">            manually.</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a><span class="sd">        FileClass: The class to use for uploaded files.  Defaults to :class:`File`, but you can provide your own class</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><span class="sd">            if you wish to customize behaviour.  The class will be instantiated as FileClass(file_name, field_name), and</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><span class="sd">            it must provide the following functions::</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><span class="sd">                - file_instance.write(data)</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a><span class="sd">                - file_instance.finalize()</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a><span class="sd">                - file_instance.close()</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a><span class="sd">        FieldClass: The class to use for uploaded fields.  Defaults to :class:`Field`, but you can provide your own</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="sd">            class if you wish to customize behaviour.  The class will be instantiated as FieldClass(field_name), and it</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><span class="sd">            must provide the following functions::</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><span class="sd">                - field_instance.write(data)</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="sd">                - field_instance.finalize()</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><span class="sd">                - field_instance.close()</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="sd">                - field_instance.set_none()</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><span class="sd">        config: Configuration to use for this FormParser.  The default values are taken from the DEFAULT_CONFIG value,</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a><span class="sd">            and then any keys present in this dictionary will overwrite the default values.</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>    <span class="c1">#: This is the default configuration for our form parser.</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>    <span class="c1">#: Note: all file sizes should be in bytes.</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>    <span class="n">DEFAULT_CONFIG</span><span class="p">:</span> <span class="n">FormParserConfig</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>        <span class="s2">&quot;MAX_BODY_SIZE&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>        <span class="s2">&quot;MAX_MEMORY_FILE_SIZE&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>        <span class="s2">&quot;UPLOAD_DIR&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>        <span class="s2">&quot;UPLOAD_KEEP_FILENAME&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="s2">&quot;UPLOAD_KEEP_EXTENSIONS&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="c1"># Error on invalid Content-Transfer-Encoding?</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>        <span class="s2">&quot;UPLOAD_ERROR_ON_BAD_CTE&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>    <span class="p">}</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>        <span class="n">on_field</span><span class="p">:</span> <span class="n">OnFieldCallback</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="n">on_file</span><span class="p">:</span> <span class="n">OnFileCallback</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>        <span class="n">on_end</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>        <span class="n">boundary</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>        <span class="n">file_name</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>        <span class="n">FileClass</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">FileProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="n">File</span><span class="p">,</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>        <span class="n">FieldClass</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">FieldProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">,</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>        <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>        <span class="c1"># Save variables.</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span> <span class="o">=</span> <span class="n">boundary</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_received</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>        <span class="c1"># Save callbacks.</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_field</span> <span class="o">=</span> <span class="n">on_field</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_file</span> <span class="o">=</span> <span class="n">on_file</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span> <span class="o">=</span> <span class="n">on_end</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>        <span class="c1"># Save classes.</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">FileClass</span> <span class="o">=</span> <span class="n">File</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">FieldClass</span> <span class="o">=</span> <span class="n">Field</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>        <span class="c1"># Set configuration options.</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="n">FormParserConfig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_CONFIG</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>  <span class="c1"># type: ignore[typeddict-item]</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>        <span class="n">parser</span><span class="p">:</span> <span class="n">OctetStreamParser</span> <span class="o">|</span> <span class="n">MultipartParser</span> <span class="o">|</span> <span class="n">QuerystringParser</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>        <span class="c1"># Depending on the Content-Type, we instantiate the correct parser.</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>        <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>            <span class="n">file</span><span class="p">:</span> <span class="n">FileProtocol</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="k">nonlocal</span> <span class="n">file</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;FileConfig&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">))</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                <span class="k">nonlocal</span> <span class="n">file</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_on_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>                <span class="k">nonlocal</span> <span class="n">file</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>                <span class="c1"># Finalize the file itself.</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                <span class="n">file</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                <span class="c1"># Call our callback.</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                <span class="k">if</span> <span class="n">on_file</span><span class="p">:</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>                    <span class="n">on_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>                <span class="c1"># Call the on-end callback.</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span><span class="p">()</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>            <span class="c1"># Instantiate an octet-stream parser</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">OctetStreamParser</span><span class="p">(</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>                <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;on_start&quot;</span><span class="p">:</span> <span class="n">on_start</span><span class="p">,</span> <span class="s2">&quot;on_data&quot;</span><span class="p">:</span> <span class="n">on_data</span><span class="p">,</span> <span class="s2">&quot;on_end&quot;</span><span class="p">:</span> <span class="n">_on_end</span><span class="p">},</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;MAX_BODY_SIZE&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>            <span class="p">)</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>        <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span> <span class="ow">or</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/x-url-encoded&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>            <span class="n">name_buffer</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>            <span class="n">f</span><span class="p">:</span> <span class="n">FieldProtocol</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_field_start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                <span class="k">pass</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_field_name</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                <span class="n">name_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_field_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                <span class="k">nonlocal</span> <span class="n">f</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">FieldClass</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_buffer</span><span class="p">))</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                    <span class="k">del</span> <span class="n">name_buffer</span><span class="p">[:]</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_field_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                <span class="k">nonlocal</span> <span class="n">f</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                <span class="c1"># Finalize and call callback.</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                    <span class="c1"># If we get here, it&#39;s because there was no field data.</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                    <span class="c1"># We create a field, set it to None, and then continue.</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">FieldClass</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_buffer</span><span class="p">))</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                    <span class="k">del</span> <span class="n">name_buffer</span><span class="p">[:]</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                    <span class="n">f</span><span class="o">.</span><span class="n">set_none</span><span class="p">()</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                <span class="n">f</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                <span class="k">if</span> <span class="n">on_field</span><span class="p">:</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                    <span class="n">on_field</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_on_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span><span class="p">()</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="c1"># Instantiate parser.</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">QuerystringParser</span><span class="p">(</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                    <span class="s2">&quot;on_field_start&quot;</span><span class="p">:</span> <span class="n">on_field_start</span><span class="p">,</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                    <span class="s2">&quot;on_field_name&quot;</span><span class="p">:</span> <span class="n">on_field_name</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                    <span class="s2">&quot;on_field_data&quot;</span><span class="p">:</span> <span class="n">on_field_data</span><span class="p">,</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                    <span class="s2">&quot;on_field_end&quot;</span><span class="p">:</span> <span class="n">on_field_end</span><span class="p">,</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                    <span class="s2">&quot;on_end&quot;</span><span class="p">:</span> <span class="n">_on_end</span><span class="p">,</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                <span class="p">},</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;MAX_BODY_SIZE&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>            <span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>        <span class="k">elif</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;multipart/form-data&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>            <span class="k">if</span> <span class="n">boundary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No boundary given&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="k">raise</span> <span class="n">FormParserError</span><span class="p">(</span><span class="s2">&quot;No boundary given&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="n">header_name</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>            <span class="n">header_value</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>            <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>            <span class="n">f_multi</span><span class="p">:</span> <span class="n">FileProtocol</span> <span class="o">|</span> <span class="n">FieldProtocol</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>            <span class="n">writer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>            <span class="n">is_file</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_part_begin</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                <span class="c1"># Reset headers in case this isn&#39;t the first part.</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                <span class="k">nonlocal</span> <span class="n">headers</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_part_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>                <span class="k">nonlocal</span> <span class="n">writer</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>                <span class="k">assert</span> <span class="n">writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                <span class="c1"># TODO: check for error here.</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_part_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                <span class="k">nonlocal</span> <span class="n">f_multi</span><span class="p">,</span> <span class="n">is_file</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                <span class="k">assert</span> <span class="n">f_multi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                <span class="n">f_multi</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                <span class="k">if</span> <span class="n">is_file</span><span class="p">:</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                    <span class="k">if</span> <span class="n">on_file</span><span class="p">:</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                        <span class="n">on_file</span><span class="p">(</span><span class="n">f_multi</span><span class="p">)</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>                    <span class="k">if</span> <span class="n">on_field</span><span class="p">:</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>                        <span class="n">on_field</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;FieldProtocol&quot;</span><span class="p">,</span> <span class="n">f_multi</span><span class="p">))</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_header_field</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                <span class="n">header_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_header_value</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                <span class="n">header_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_header_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                <span class="n">headers</span><span class="p">[</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_name</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_value</span><span class="p">)</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                <span class="k">del</span> <span class="n">header_name</span><span class="p">[:]</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                <span class="k">del</span> <span class="n">header_value</span><span class="p">[:]</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">on_headers_finished</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                <span class="k">nonlocal</span> <span class="n">is_file</span><span class="p">,</span> <span class="n">f_multi</span><span class="p">,</span> <span class="n">writer</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                <span class="c1"># Reset the &#39;is file&#39; flag.</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>                <span class="n">is_file</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>                <span class="c1"># Parse the content-disposition header.</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                <span class="c1"># TODO: handle mixed case</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>                <span class="n">content_disp</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                <span class="n">disp</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">parse_options_header</span><span class="p">(</span><span class="n">content_disp</span><span class="p">)</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>                <span class="c1"># Get the field and filename.</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>                <span class="n">field_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>                <span class="c1"># TODO: check for errors</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>                <span class="c1"># Create the proper class.</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>                <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>                    <span class="n">f_multi</span> <span class="o">=</span> <span class="n">FieldClass</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                    <span class="n">f_multi</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;FileConfig&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">))</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>                    <span class="n">is_file</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>                <span class="c1"># Parse the given Content-Transfer-Encoding to determine what</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                <span class="c1"># we need to do with the incoming data.</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>                <span class="c1"># TODO: check that we properly handle 8bit / 7bit encoding.</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                <span class="n">transfer_encoding</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Content-Transfer-Encoding&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;7bit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                <span class="k">if</span> <span class="n">transfer_encoding</span> <span class="ow">in</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;8bit&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;7bit&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                    <span class="n">writer</span> <span class="o">=</span> <span class="n">f_multi</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                <span class="k">elif</span> <span class="n">transfer_encoding</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;base64&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>                    <span class="n">writer</span> <span class="o">=</span> <span class="n">Base64Decoder</span><span class="p">(</span><span class="n">f_multi</span><span class="p">)</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>                <span class="k">elif</span> <span class="n">transfer_encoding</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;quoted-printable&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                    <span class="n">writer</span> <span class="o">=</span> <span class="n">QuotedPrintableDecoder</span><span class="p">(</span><span class="n">f_multi</span><span class="p">)</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown Content-Transfer-Encoding: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transfer_encoding</span><span class="p">)</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;UPLOAD_ERROR_ON_BAD_CTE&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                        <span class="k">raise</span> <span class="n">FormParserError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown Content-Transfer-Encoding &quot;</span><span class="si">{</span><span class="n">transfer_encoding</span><span class="si">!r}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                        <span class="c1"># If we aren&#39;t erroring, then we just treat this as an</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                        <span class="c1"># unencoded Content-Transfer-Encoding.</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>                        <span class="n">writer</span> <span class="o">=</span> <span class="n">f_multi</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_on_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                <span class="k">nonlocal</span> <span class="n">writer</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>                <span class="k">if</span> <span class="n">writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>                    <span class="n">writer</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">on_end</span><span class="p">()</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>            <span class="c1"># Instantiate a multipart parser.</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">MultipartParser</span><span class="p">(</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                <span class="n">boundary</span><span class="p">,</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>                <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                    <span class="s2">&quot;on_part_begin&quot;</span><span class="p">:</span> <span class="n">on_part_begin</span><span class="p">,</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                    <span class="s2">&quot;on_part_data&quot;</span><span class="p">:</span> <span class="n">on_part_data</span><span class="p">,</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                    <span class="s2">&quot;on_part_end&quot;</span><span class="p">:</span> <span class="n">on_part_end</span><span class="p">,</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                    <span class="s2">&quot;on_header_field&quot;</span><span class="p">:</span> <span class="n">on_header_field</span><span class="p">,</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                    <span class="s2">&quot;on_header_value&quot;</span><span class="p">:</span> <span class="n">on_header_value</span><span class="p">,</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                    <span class="s2">&quot;on_header_end&quot;</span><span class="p">:</span> <span class="n">on_header_end</span><span class="p">,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>                    <span class="s2">&quot;on_headers_finished&quot;</span><span class="p">:</span> <span class="n">on_headers_finished</span><span class="p">,</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>                    <span class="s2">&quot;on_end&quot;</span><span class="p">:</span> <span class="n">_on_end</span><span class="p">,</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>                <span class="p">},</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>                <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;MAX_BODY_SIZE&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>            <span class="p">)</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown Content-Type: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>            <span class="k">raise</span> <span class="n">FormParserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown Content-Type: </span><span class="si">{</span><span class="n">content_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write some data.  The parser will forward this to the appropriate</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">        underlying parser.</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">            data: The data to write.</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a><span class="sd">            The number of bytes processed.</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_received</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>        <span class="c1"># TODO: check the parser&#39;s return value for errors?</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finalize the parser.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;finalize&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the parser.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(content_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="si">!r}</span><span class="s2">, parser=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="python_multipart.FormParser-functions">Functions<a href="#python_multipart.FormParser-functions" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.FormParser.close" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#python_multipart.FormParser.close" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Close the parser.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1774" name="__codelineno-0-1774"></a><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Close the parser.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.FormParser.finalize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">finalize</span><span class="p">()</span></code>

<a href="#python_multipart.FormParser.finalize" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Finalize the parser.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Finalize the parser.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;finalize&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.FormParser.write" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#python_multipart.FormParser.write" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Write some data.  The parser will forward this to the appropriate
underlying parser.</p>
<p>Args:
    data: The data to write.</p>
<p>Returns:
    The number of bytes processed.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write some data.  The parser will forward this to the appropriate</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">    underlying parser.</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">        data: The data to write.</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a><span class="sd">        The number of bytes processed.</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">bytes_received</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>    <span class="c1"># TODO: check the parser&#39;s return value for errors?</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.MultipartParser" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>MultipartParser</code>


<a href="#python_multipart.MultipartParser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;BaseParser&lt;/code&gt; (&lt;code&gt;python_multipart.multipart.BaseParser&lt;/code&gt;)" href="#python_multipart.BaseParser">BaseParser</a></code></p>



        <p>This class is a streaming multipart/form-data parser.</p>
<table>
<thead>
<tr>
<th>Callback Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>on_part_begin</td>
<td>None</td>
<td>Called when a new part of the multipart message is encountered.</td>
</tr>
<tr>
<td>on_part_data</td>
<td>data, start, end</td>
<td>Called when a portion of a part's data is encountered.</td>
</tr>
<tr>
<td>on_part_end</td>
<td>None</td>
<td>Called when the end of a part is reached.</td>
</tr>
<tr>
<td>on_header_begin</td>
<td>None</td>
<td>Called when we've found a new header in a part of a multipart message</td>
</tr>
<tr>
<td>on_header_field</td>
<td>data, start, end</td>
<td>Called each time an additional portion of a header is read (i.e. the part of the header that is before the colon; the "Foo" in "Foo: Bar").</td>
</tr>
<tr>
<td>on_header_value</td>
<td>data, start, end</td>
<td>Called when we get data for a header.</td>
</tr>
<tr>
<td>on_header_end</td>
<td>None</td>
<td>Called when the current header is finished - i.e. we've reached the newline at the end of the header.</td>
</tr>
<tr>
<td>on_headers_finished</td>
<td>None</td>
<td>Called when all headers are finished, and before the part data starts.</td>
</tr>
<tr>
<td>on_end</td>
<td>None</td>
<td>Called when the parser is finished parsing all data.</td>
</tr>
</tbody>
</table>
<p>Args:
    boundary: The multipart boundary.  This is required, and must match what is given in the HTTP request - usually in the Content-Type header.
    callbacks: A dictionary of callbacks.  See the documentation for <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;BaseParser&lt;/code&gt;" href="#python_multipart.BaseParser"><code>BaseParser</code></a>.
    max_size: The maximum size of body to parse.  Defaults to infinity - i.e. unbounded.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/multipart.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-957" name="__codelineno-0-957"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultipartParser</span><span class="p">(</span><span class="n">BaseParser</span><span class="p">):</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is a streaming multipart/form-data parser.</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    | Callback Name      | Parameters      | Description |</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">    |--------------------|-----------------|-------------|</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">    | on_part_begin      | None            | Called when a new part of the multipart message is encountered. |</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    | on_part_data       | data, start, end| Called when a portion of a part&#39;s data is encountered. |</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">    | on_part_end        | None            | Called when the end of a part is reached. |</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">    | on_header_begin    | None            | Called when we&#39;ve found a new header in a part of a multipart message |</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    | on_header_field    | data, start, end| Called each time an additional portion of a header is read (i.e. the part of the header that is before the colon; the &quot;Foo&quot; in &quot;Foo: Bar&quot;). |</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    | on_header_value    | data, start, end| Called when we get data for a header. |</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">    | on_header_end      | None            | Called when the current header is finished - i.e. we&#39;ve reached the newline at the end of the header. |</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    | on_headers_finished| None            | Called when all headers are finished, and before the part data starts. |</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">    | on_end             | None            | Called when the parser is finished parsing all data. |</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">        boundary: The multipart boundary.  This is required, and must match what is given in the HTTP request - usually in the Content-Type header.</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">        callbacks: A dictionary of callbacks.  See the documentation for [`BaseParser`][python_multipart.BaseParser].</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">        max_size: The maximum size of body to parse.  Defaults to infinity - i.e. unbounded.</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">:</span> <span class="n">MultipartCallbacks</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">max_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="c1"># Initialize parser state.</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">START</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">or</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_size must be a positive number, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">max_size</span><span class="p">)</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">max_size</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="c1"># Setup marks.  These are used to track the state of data received.</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>        <span class="c1"># Save our boundary.</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="n">boundary</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">--&quot;</span> <span class="o">+</span> <span class="n">boundary</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write some data to the parser, which will perform size verification,</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">        and then parse the data into the appropriate location (e.g. header,</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">        data, etc.), and pass this on to the underlying callback.  If an error</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">        is encountered, a MultipartParseError will be raised.  The &quot;offset&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">        attribute on the raised exception will be set to the offset of the byte</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">        in the input chunk that caused the error.</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">            data: The data to write to the parser.</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">            The number of bytes written.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span class="c1"># Handle sizing.</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+</span> <span class="n">data_len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>            <span class="c1"># We truncate the length of data that we are to process.</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            <span class="n">new_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                <span class="s2">&quot;Current size is </span><span class="si">%d</span><span class="s2"> (max </span><span class="si">%d</span><span class="s2">), so truncating data length from </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                <span class="n">data_len</span><span class="p">,</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                <span class="n">new_size</span><span class="p">,</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="n">data_len</span> <span class="o">=</span> <span class="n">new_size</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+=</span> <span class="n">l</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>        <span class="k">return</span> <span class="n">l</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="c1"># Get values from locals.</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="c1"># Get our state, flags and index.  These are persisted between calls to</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="c1"># this function.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="c1"># Our index defaults to 0.</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="c1"># Set a mark.</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">set_mark</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>        <span class="c1"># Remove a mark.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">delete_mark</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="c1"># Helper function that makes calling a callback with data easier. The</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>        <span class="c1"># &#39;remaining&#39; parameter will callback from the marked value until the</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="c1"># end of the buffer, and reset the mark, instead of deleting it.  This</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="c1"># is used at the end of the function to call our callbacks with any</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="c1"># remaining data in this chunk.</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">data_callback</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">CallbackName</span><span class="p">,</span> <span class="n">end_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">remaining</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>            <span class="n">marked_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="k">if</span> <span class="n">marked_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                <span class="k">return</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>            <span class="c1"># Otherwise, we call it from the mark to the current byte we&#39;re</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="c1"># processing.</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="k">if</span> <span class="n">end_i</span> <span class="o">&lt;=</span> <span class="n">marked_index</span><span class="p">:</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="c1"># There is no additional data to send.</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                <span class="k">pass</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>            <span class="k">elif</span> <span class="n">marked_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>                <span class="c1"># We are emitting data from the local buffer.</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">marked_index</span><span class="p">,</span> <span class="n">end_i</span><span class="p">)</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>                <span class="c1"># Some of the data comes from a partial boundary match.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>                <span class="c1"># and requires look-behind.</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                <span class="c1"># We need to use self.flags (and not flags) because we care about</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>                <span class="c1"># the state when we entered the loop.</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                <span class="n">lookbehind_len</span> <span class="o">=</span> <span class="o">-</span><span class="n">marked_index</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>                <span class="k">if</span> <span class="n">lookbehind_len</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary</span><span class="p">):</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lookbehind_len</span><span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FLAG_PART_BOUNDARY</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                    <span class="n">lookback</span> <span class="o">=</span> <span class="n">boundary</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lookbehind_len</span><span class="p">)</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FLAG_LAST_BOUNDARY</span><span class="p">:</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                    <span class="n">lookback</span> <span class="o">=</span> <span class="n">boundary</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;--</span><span class="se">\r\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lookbehind_len</span><span class="p">)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover (error case)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Look-back buffer error&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                <span class="k">if</span> <span class="n">end_i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">end_i</span><span class="p">)</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="c1"># If we&#39;re getting remaining data, we have got all the data we</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="c1"># can be certain is not a boundary, leaving only a partial boundary match.</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="k">if</span> <span class="n">remaining</span><span class="p">:</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_i</span> <span class="o">-</span> <span class="n">length</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>        <span class="c1"># For each byte...</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">START</span><span class="p">:</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                <span class="c1"># Skip leading newlines</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">CR</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="n">LF</span><span class="p">:</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                <span class="c1"># index is used as in index into our boundary.  Set to 0.</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                <span class="c1"># Move to the next state, but decrement i so that we re-process</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                <span class="c1"># this character.</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">START_BOUNDARY</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">START_BOUNDARY</span><span class="p">:</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                <span class="c1"># Check to ensure that the last 2 characters in our boundary</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                <span class="c1"># are CRLF.</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">HYPHEN</span><span class="p">:</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                        <span class="c1"># Potential empty message.</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                        <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">END_BOUNDARY</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>                    <span class="k">elif</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">CR</span><span class="p">:</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                        <span class="c1"># Error!</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Did not find CR at end of boundary (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>                        <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>                        <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>                <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">LF</span><span class="p">:</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Did not find LF at end of boundary (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                        <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>                        <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>                    <span class="c1"># The index is now used for indexing into our boundary.</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>                    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>                    <span class="c1"># Callback for the start of a part.</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;part_begin&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>                    <span class="c1"># Move to the next character and state.</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_FIELD_START</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                    <span class="c1"># Check to ensure our boundary matches</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">boundary</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Expected boundary character </span><span class="si">%r</span><span class="s2">, got </span><span class="si">%r</span><span class="s2"> at index </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">boundary</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>                        <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                        <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>                        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>                    <span class="c1"># Increment index into boundary and continue.</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_FIELD_START</span><span class="p">:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                <span class="c1"># Mark the start of a header field here, reset the index, and</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>                <span class="c1"># continue parsing our header field.</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>                <span class="c1"># Set a mark of our header field.</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>                <span class="n">set_mark</span><span class="p">(</span><span class="s2">&quot;header_field&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                <span class="c1"># Notify that we&#39;re starting a header if the next character is</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>                <span class="c1"># not a CR; a CR at the beginning of the header will cause us</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                <span class="c1"># to stop parsing headers in the MultipartState.HEADER_FIELD state,</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                <span class="c1"># below.</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">CR</span><span class="p">:</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;header_begin&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                <span class="c1"># Move to parsing header fields.</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>                <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_FIELD</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_FIELD</span><span class="p">:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                <span class="c1"># If we&#39;ve reached a CR at the beginning of a header, it means</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                <span class="c1"># that we&#39;ve reached the second of 2 newlines, and so there are</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                <span class="c1"># no more headers to parse.</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">CR</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>                    <span class="n">delete_mark</span><span class="p">(</span><span class="s2">&quot;header_field&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADERS_ALMOST_DONE</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="c1"># Increment our index in the header.</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="c1"># If we&#39;ve reached a colon, we&#39;re done with this header.</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">COLON</span><span class="p">:</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                    <span class="c1"># A 0-length header is an error.</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Found 0-length header at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                        <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                        <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                    <span class="c1"># Call our callback with the header field.</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                    <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;header_field&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                    <span class="c1"># Move to parsing the header value.</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_VALUE_START</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>                <span class="k">elif</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TOKEN_CHARS_SET</span><span class="p">:</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Found invalid character </span><span class="si">%r</span><span class="s2"> in header at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>                    <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>                    <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>                    <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_VALUE_START</span><span class="p">:</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>                <span class="c1"># Skip leading spaces.</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SPACE</span><span class="p">:</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>                <span class="c1"># Mark the start of the header value.</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>                <span class="n">set_mark</span><span class="p">(</span><span class="s2">&quot;header_value&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>                <span class="c1"># Move to the header-value state, reprocessing this character.</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>                <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_VALUE</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_VALUE</span><span class="p">:</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                <span class="c1"># If we&#39;ve got a CR, we&#39;re nearly done our headers.  Otherwise,</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                <span class="c1"># we do nothing and just move past this character.</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">CR</span><span class="p">:</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                    <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;header_value&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;header_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_VALUE_ALMOST_DONE</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_VALUE_ALMOST_DONE</span><span class="p">:</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                <span class="c1"># The last character should be a LF.  If not, it&#39;s an error.</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">LF</span><span class="p">:</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Did not find LF character at end of header (found </span><span class="si">{</span><span class="n">c</span><span class="si">!r}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                    <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                    <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                    <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                <span class="c1"># Move back to the start of another header.  Note that if that</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>                <span class="c1"># state detects ANOTHER newline, it&#39;ll trigger the end of our</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                <span class="c1"># headers.</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>                <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_FIELD_START</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADERS_ALMOST_DONE</span><span class="p">:</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>                <span class="c1"># We&#39;re almost done our headers.  This is reached when we parse</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>                <span class="c1"># a CR at the beginning of a header, so our next character</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>                <span class="c1"># should be a LF, or it&#39;s an error.</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">LF</span><span class="p">:</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Did not find LF at end of headers (found </span><span class="si">{</span><span class="n">c</span><span class="si">!r}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>                    <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>                    <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>                    <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;headers_finished&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">PART_DATA_START</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">PART_DATA_START</span><span class="p">:</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>                <span class="c1"># Mark the start of our part data.</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>                <span class="n">set_mark</span><span class="p">(</span><span class="s2">&quot;part_data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                <span class="c1"># Start processing part data, including this character.</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>                <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">PART_DATA</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">PART_DATA</span><span class="p">:</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>                <span class="c1"># We&#39;re processing our part data right now.  During this, we</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                <span class="c1"># need to efficiently search for our boundary, since any data</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>                <span class="c1"># on any number of lines can be a part of the current data.</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="c1"># Save the current value of our index.  We use this in case we</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                <span class="c1"># find part of a boundary, but it doesn&#39;t match fully.</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                <span class="n">prev_index</span> <span class="o">=</span> <span class="n">index</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                <span class="c1"># Set up variables.</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>                <span class="n">boundary_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>                <span class="n">data_length</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>                <span class="c1"># If our index is 0, we&#39;re starting a new part, so start our</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>                <span class="c1"># search.</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>                    <span class="c1"># The most common case is likely to be that the whole</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                    <span class="c1"># boundary is present in the buffer.</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>                    <span class="c1"># Calling `find` is much faster than iterating here.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                    <span class="n">i0</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">data_length</span><span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>                    <span class="k">if</span> <span class="n">i0</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>                        <span class="c1"># We matched the whole boundary string.</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>                        <span class="n">index</span> <span class="o">=</span> <span class="n">boundary_length</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>                        <span class="n">i</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="n">boundary_length</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                        <span class="c1"># No match found for whole string.</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>                        <span class="c1"># There may be a partial boundary at the end of the</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                        <span class="c1"># data, which the find will not match.</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                        <span class="c1"># Since the length should to be searched is limited to</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                        <span class="c1"># the boundary length, just perform a naive search.</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>                        <span class="n">i</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">data_length</span> <span class="o">-</span> <span class="n">boundary_length</span><span class="p">)</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>                        <span class="c1"># Search forward until we either hit the end of our buffer,</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>                        <span class="c1"># or reach a potential start of the boundary.</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>                        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data_length</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">boundary</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>                    <span class="n">c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>                <span class="c1"># Now, we have a couple of cases here.  If our index is before</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>                <span class="c1"># the end of the boundary...</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">boundary_length</span><span class="p">:</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>                    <span class="c1"># If the character matches...</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>                    <span class="k">if</span> <span class="n">boundary</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                        <span class="c1"># The current character matches, so continue!</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>                <span class="c1"># Our index is equal to the length of our boundary!</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="n">boundary_length</span><span class="p">:</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                    <span class="c1"># First we increment it.</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                    <span class="c1"># Now, if we&#39;ve reached a newline, we need to set this as</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>                    <span class="c1"># the potential end of our boundary.</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">CR</span><span class="p">:</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                        <span class="n">flags</span> <span class="o">|=</span> <span class="n">FLAG_PART_BOUNDARY</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>                    <span class="c1"># Otherwise, if this is a hyphen, we might be at the last</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>                    <span class="c1"># of all boundaries.</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">HYPHEN</span><span class="p">:</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                        <span class="n">flags</span> <span class="o">|=</span> <span class="n">FLAG_LAST_BOUNDARY</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>                    <span class="c1"># Otherwise, we reset our index, since this isn&#39;t either a</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>                    <span class="c1"># newline or a hyphen.</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>                        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>                <span class="c1"># Our index is right after the part boundary, which should be</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                <span class="c1"># a LF.</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="n">boundary_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                    <span class="c1"># If we&#39;re at a part boundary (i.e. we&#39;ve seen a CR</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>                    <span class="c1"># character already)...</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>                    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FLAG_PART_BOUNDARY</span><span class="p">:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>                        <span class="c1"># We need a LF character next.</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>                        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">LF</span><span class="p">:</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>                            <span class="c1"># Unset the part boundary flag.</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>                            <span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FLAG_PART_BOUNDARY</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>                            <span class="c1"># We have identified a boundary, callback for any data before it.</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>                            <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;part_data&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>                            <span class="c1"># Callback indicating that we&#39;ve reached the end of</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                            <span class="c1"># a part, and are starting a new one.</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;part_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;part_begin&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>                            <span class="c1"># Move to parsing new headers.</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>                            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>                            <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">HEADER_FIELD_START</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>                            <span class="k">continue</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>                        <span class="c1"># We didn&#39;t find an LF character, so no match.  Reset</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>                        <span class="c1"># our index and clear our flag.</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>                        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>                        <span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FLAG_PART_BOUNDARY</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>                    <span class="c1"># Otherwise, if we&#39;re at the last boundary (i.e. we&#39;ve</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>                    <span class="c1"># seen a hyphen already)...</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>                    <span class="k">elif</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FLAG_LAST_BOUNDARY</span><span class="p">:</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>                        <span class="c1"># We need a second hyphen here.</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>                        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">HYPHEN</span><span class="p">:</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>                            <span class="c1"># We have identified a boundary, callback for any data before it.</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                            <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;part_data&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                            <span class="c1"># Callback to end the current part, and then the</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>                            <span class="c1"># message.</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;part_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                            <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">END</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>                            <span class="c1"># No match, so reset index.</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>                            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>                <span class="c1"># Otherwise, our index is 0.  If the previous index is not, it</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>                <span class="c1"># means we reset something, and we need to take the data we</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                <span class="c1"># thought was part of our boundary and send it along as actual</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>                <span class="c1"># data.</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prev_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                    <span class="c1"># Overwrite our previous index.</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                    <span class="n">prev_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>                    <span class="c1"># Re-consider the current character, since this could be</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>                    <span class="c1"># the start of the boundary itself.</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">END_BOUNDARY</span><span class="p">:</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>                    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">HYPHEN</span><span class="p">:</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Did not find - at end of boundary (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                        <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                        <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>                        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">END</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">MultipartState</span><span class="o">.</span><span class="n">END</span><span class="p">:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="c1"># Don&#39;t do anything if chunk ends with CRLF.</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">CR</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">length</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">LF</span><span class="p">:</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                <span class="c1"># Skip data after the last boundary.</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Skipping data after last boundary&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>                <span class="n">i</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>                <span class="k">break</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover (error case)</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>                <span class="c1"># We got into a strange state somehow!  Just stop processing.</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Reached an unknown state </span><span class="si">%d</span><span class="s2"> at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">MultipartParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>            <span class="c1"># Move to the next byte.</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>        <span class="c1"># We call our callbacks with any remaining data.  Note that we pass</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>        <span class="c1"># the &#39;remaining&#39; flag, which sets the mark back to 0 instead of</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>        <span class="c1"># deleting it, if it&#39;s found.  This is because, if the mark is found</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>        <span class="c1"># at this point, we assume that there&#39;s data for one of these things</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>        <span class="c1"># that has been parsed, but not yet emitted.  And, as such, it implies</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="c1"># that we haven&#39;t yet reached the end of this &#39;thing&#39;.  So, by setting</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>        <span class="c1"># the mark to 0, we cause any data callbacks that take place in future</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>        <span class="c1"># calls to this function to start from the beginning of that buffer.</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>        <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;header_field&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>        <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;header_value&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>        <span class="n">data_callback</span><span class="p">(</span><span class="s2">&quot;part_data&quot;</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>        <span class="c1"># Save values to locals.</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="c1"># Return our data length to indicate no errors, and that we processed</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="c1"># all of it.</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>        <span class="k">return</span> <span class="n">length</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finalize this parser, which signals to that we are finished parsing.</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">        Note: It does not currently, but in the future, it will verify that we</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="sd">        are in the final state of the parser (i.e. the end of the multipart</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">        message is well-formed), and, if not, throw an error.</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>        <span class="c1"># TODO: verify that we&#39;re in the state MultipartState.END, otherwise throw an</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="c1"># error or otherwise state that we&#39;re not finished parsing.</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>        <span class="k">pass</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(boundary=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="python_multipart.MultipartParser-functions">Functions<a href="#python_multipart.MultipartParser-functions" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.MultipartParser.finalize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">finalize</span><span class="p">()</span></code>

<a href="#python_multipart.MultipartParser.finalize" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Finalize this parser, which signals to that we are finished parsing.</p>
<p>Note: It does not currently, but in the future, it will verify that we
are in the final state of the parser (i.e. the end of the multipart
message is well-formed), and, if not, throw an error.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Finalize this parser, which signals to that we are finished parsing.</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">    Note: It does not currently, but in the future, it will verify that we</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="sd">    are in the final state of the parser (i.e. the end of the multipart</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">    message is well-formed), and, if not, throw an error.</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>    <span class="c1"># TODO: verify that we&#39;re in the state MultipartState.END, otherwise throw an</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>    <span class="c1"># error or otherwise state that we&#39;re not finished parsing.</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.MultipartParser.write" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#python_multipart.MultipartParser.write" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Write some data to the parser, which will perform size verification,
and then parse the data into the appropriate location (e.g. header,
data, etc.), and pass this on to the underlying callback.  If an error
is encountered, a MultipartParseError will be raised.  The "offset"
attribute on the raised exception will be set to the offset of the byte
in the input chunk that caused the error.</p>
<p>Args:
    data: The data to write to the parser.</p>
<p>Returns:
    The number of bytes written.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write some data to the parser, which will perform size verification,</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">    and then parse the data into the appropriate location (e.g. header,</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">    data, etc.), and pass this on to the underlying callback.  If an error</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">    is encountered, a MultipartParseError will be raised.  The &quot;offset&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">    attribute on the raised exception will be set to the offset of the byte</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">    in the input chunk that caused the error.</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">        data: The data to write to the parser.</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">        The number of bytes written.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>    <span class="c1"># Handle sizing.</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>    <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+</span> <span class="n">data_len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>        <span class="c1"># We truncate the length of data that we are to process.</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="n">new_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>            <span class="s2">&quot;Current size is </span><span class="si">%d</span><span class="s2"> (max </span><span class="si">%d</span><span class="s2">), so truncating data length from </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>            <span class="n">data_len</span><span class="p">,</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            <span class="n">new_size</span><span class="p">,</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="n">data_len</span> <span class="o">=</span> <span class="n">new_size</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+=</span> <span class="n">l</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="k">return</span> <span class="n">l</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.OctetStreamParser" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>OctetStreamParser</code>


<a href="#python_multipart.OctetStreamParser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;BaseParser&lt;/code&gt; (&lt;code&gt;python_multipart.multipart.BaseParser&lt;/code&gt;)" href="#python_multipart.BaseParser">BaseParser</a></code></p>



        <p>This parser parses an octet-stream request body and calls callbacks when
incoming data is received.  Callbacks are as follows:</p>
<table>
<thead>
<tr>
<th>Callback Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>on_start</td>
<td>None</td>
<td>Called when the first data is parsed.</td>
</tr>
<tr>
<td>on_data</td>
<td>data, start, end</td>
<td>Called for each data chunk that is parsed.</td>
</tr>
<tr>
<td>on_end</td>
<td>None</td>
<td>Called when the parser is finished parsing all data.</td>
</tr>
</tbody>
</table>
<p>Args:
    callbacks: A dictionary of callbacks.  See the documentation for <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;BaseParser&lt;/code&gt;" href="#python_multipart.BaseParser"><code>BaseParser</code></a>.
    max_size: The maximum size of body to parse.  Defaults to infinity - i.e. unbounded.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/multipart.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="k">class</span><span class="w"> </span><span class="nc">OctetStreamParser</span><span class="p">(</span><span class="n">BaseParser</span><span class="p">):</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This parser parses an octet-stream request body and calls callbacks when</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">    incoming data is received.  Callbacks are as follows:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">    | Callback Name  | Parameters      | Description                                         |</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">    |----------------|-----------------|-----------------------------------------------------|</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    | on_start       | None            | Called when the first data is parsed.               |</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    | on_data        | data, start, end| Called for each data chunk that is parsed.           |</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    | on_end         | None            | Called when the parser is finished parsing all data.|</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">        callbacks: A dictionary of callbacks.  See the documentation for [`BaseParser`][python_multipart.BaseParser].</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        max_size: The maximum size of body to parse.  Defaults to infinity - i.e. unbounded.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">:</span> <span class="n">OctetStreamCallbacks</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">max_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)):</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">or</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_size must be a positive number, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">max_size</span><span class="p">)</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">max_size</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write some data to the parser, which will perform size verification,</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        and then pass the data to the underlying callback.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">            data: The data to write to the parser.</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">            The number of bytes written.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span><span class="p">:</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="c1"># Truncate data length.</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+</span> <span class="n">data_len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="c1"># We truncate the length of data that we are to process.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="n">new_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                <span class="s2">&quot;Current size is </span><span class="si">%d</span><span class="s2"> (max </span><span class="si">%d</span><span class="s2">), so truncating data length from </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                <span class="n">data_len</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                <span class="n">new_size</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">data_len</span> <span class="o">=</span> <span class="n">new_size</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="c1"># Increment size, then callback, in case there&#39;s an exception.</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+=</span> <span class="n">data_len</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="k">return</span> <span class="n">data_len</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finalize this parser, which signals to that we are finished parsing,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">        and sends the on_end callback.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="python_multipart.OctetStreamParser-functions">Functions<a href="#python_multipart.OctetStreamParser-functions" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.OctetStreamParser.finalize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">finalize</span><span class="p">()</span></code>

<a href="#python_multipart.OctetStreamParser.finalize" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Finalize this parser, which signals to that we are finished parsing,
and sends the on_end callback.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Finalize this parser, which signals to that we are finished parsing,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">    and sends the on_end callback.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.OctetStreamParser.write" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#python_multipart.OctetStreamParser.write" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Write some data to the parser, which will perform size verification,
and then pass the data to the underlying callback.</p>
<p>Args:
    data: The data to write to the parser.</p>
<p>Returns:
    The number of bytes written.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write some data to the parser, which will perform size verification,</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    and then pass the data to the underlying callback.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        data: The data to write to the parser.</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        The number of bytes written.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span><span class="p">:</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="c1"># Truncate data length.</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>    <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+</span> <span class="n">data_len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="c1"># We truncate the length of data that we are to process.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="n">new_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="s2">&quot;Current size is </span><span class="si">%d</span><span class="s2"> (max </span><span class="si">%d</span><span class="s2">), so truncating data length from </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="n">data_len</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="n">new_size</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">data_len</span> <span class="o">=</span> <span class="n">new_size</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="c1"># Increment size, then callback, in case there&#39;s an exception.</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+=</span> <span class="n">data_len</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="k">return</span> <span class="n">data_len</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.QuerystringParser" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>QuerystringParser</code>


<a href="#python_multipart.QuerystringParser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;BaseParser&lt;/code&gt; (&lt;code&gt;python_multipart.multipart.BaseParser&lt;/code&gt;)" href="#python_multipart.BaseParser">BaseParser</a></code></p>



        <p>This is a streaming querystring parser.  It will consume data, and call
the callbacks given when it has data.</p>
<table>
<thead>
<tr>
<th>Callback Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>on_field_start</td>
<td>None</td>
<td>Called when a new field is encountered.</td>
</tr>
<tr>
<td>on_field_name</td>
<td>data, start, end</td>
<td>Called when a portion of a field's name is encountered.</td>
</tr>
<tr>
<td>on_field_data</td>
<td>data, start, end</td>
<td>Called when a portion of a field's data is encountered.</td>
</tr>
<tr>
<td>on_field_end</td>
<td>None</td>
<td>Called when the end of a field is encountered.</td>
</tr>
<tr>
<td>on_end</td>
<td>None</td>
<td>Called when the parser is finished parsing all data.</td>
</tr>
</tbody>
</table>
<p>Args:
    callbacks: A dictionary of callbacks.  See the documentation for <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;BaseParser&lt;/code&gt;" href="#python_multipart.BaseParser"><code>BaseParser</code></a>.
    strict_parsing: Whether or not to parse the body strictly.  Defaults to False.  If this is set to True, then the
        behavior of the parser changes as the following: if a field has a value with an equal sign
        (e.g. "foo=bar", or "foo="), it is always included.  If a field has no equals sign (e.g. "...&amp;name&amp;..."),
        it will be treated as an error if 'strict_parsing' is True, otherwise included.  If an error is encountered,
        then a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;QuerystringParseError&lt;/code&gt;" href="#python_multipart.exceptions.QuerystringParseError"><code>QuerystringParseError</code></a> will be raised.
    max_size: The maximum size of body to parse.  Defaults to infinity - i.e. unbounded.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/multipart.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="k">class</span><span class="w"> </span><span class="nc">QuerystringParser</span><span class="p">(</span><span class="n">BaseParser</span><span class="p">):</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a streaming querystring parser.  It will consume data, and call</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    the callbacks given when it has data.</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">    | Callback Name  | Parameters      | Description                                         |</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    |----------------|-----------------|-----------------------------------------------------|</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">    | on_field_start | None            | Called when a new field is encountered.             |</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">    | on_field_name  | data, start, end| Called when a portion of a field&#39;s name is encountered. |</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">    | on_field_data  | data, start, end| Called when a portion of a field&#39;s data is encountered. |</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    | on_field_end   | None            | Called when the end of a field is encountered.      |</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    | on_end         | None            | Called when the parser is finished parsing all data.|</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">        callbacks: A dictionary of callbacks.  See the documentation for [`BaseParser`][python_multipart.BaseParser].</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        strict_parsing: Whether or not to parse the body strictly.  Defaults to False.  If this is set to True, then the</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">            behavior of the parser changes as the following: if a field has a value with an equal sign</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">            (e.g. &quot;foo=bar&quot;, or &quot;foo=&quot;), it is always included.  If a field has no equals sign (e.g. &quot;...&amp;name&amp;...&quot;),</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">            it will be treated as an error if &#39;strict_parsing&#39; is True, otherwise included.  If an error is encountered,</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">            then a [`QuerystringParseError`][python_multipart.exceptions.QuerystringParseError] will be raised.</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">        max_size: The maximum size of body to parse.  Defaults to infinity - i.e. unbounded.</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="n">state</span><span class="p">:</span> <span class="n">QuerystringState</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">:</span> <span class="n">QuerystringCallbacks</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">strict_parsing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">max_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">BEFORE_FIELD</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_found_sep</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="c1"># Max-size stuff</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">or</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_size must be a positive number, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">max_size</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">max_size</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="c1"># Should parsing be strict?</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strict_parsing</span> <span class="o">=</span> <span class="n">strict_parsing</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write some data to the parser, which will perform size verification,</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">        parse into either a field name or value, and then pass the</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        corresponding data to the underlying callback.  If an error is</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        encountered while parsing, a QuerystringParseError will be raised.  The</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">        &quot;offset&quot; attribute of the raised exception will be set to the offset in</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">        the input data chunk (NOT the overall stream) that caused the error.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">            data: The data to write to the parser.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">            The number of bytes written.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>        <span class="c1"># Handle sizing.</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+</span> <span class="n">data_len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="c1"># We truncate the length of data that we are to process.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="n">new_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">)</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="s2">&quot;Current size is </span><span class="si">%d</span><span class="s2"> (max </span><span class="si">%d</span><span class="s2">), so truncating data length from </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                <span class="n">data_len</span><span class="p">,</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>                <span class="n">new_size</span><span class="p">,</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="p">)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="n">data_len</span> <span class="o">=</span> <span class="n">new_size</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+=</span> <span class="n">l</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="k">return</span> <span class="n">l</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>        <span class="n">strict_parsing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_parsing</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="n">found_sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_found_sep</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>            <span class="n">ch</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="c1"># Depending on our state...</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">BEFORE_FIELD</span><span class="p">:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                <span class="c1"># If the &#39;found_sep&#39; flag is set, we&#39;ve already encountered</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                <span class="c1"># and skipped a single separator.  If so, we check our strict</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>                <span class="c1"># parsing flag and decide what to do.  Otherwise, we haven&#39;t</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                <span class="c1"># yet reached a separator, and thus, if we do, we need to skip</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="c1"># it as it will be the boundary between fields that&#39;s supposed</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                <span class="c1"># to be there.</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">AMPERSAND</span> <span class="ow">or</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">SEMICOLON</span><span class="p">:</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>                    <span class="k">if</span> <span class="n">found_sep</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                        <span class="c1"># If we&#39;re parsing strictly, we disallow blank chunks.</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                        <span class="k">if</span> <span class="n">strict_parsing</span><span class="p">:</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                            <span class="n">e</span> <span class="o">=</span> <span class="n">QuerystringParseError</span><span class="p">(</span><span class="s2">&quot;Skipping duplicate ampersand/semicolon at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                            <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Skipping duplicate ampersand/semicolon at </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                        <span class="c1"># This case is when we&#39;re skipping the (first)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                        <span class="c1"># separator between fields, so we just set our flag</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                        <span class="c1"># and continue on.</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                        <span class="n">found_sep</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                    <span class="c1"># Emit a field-start event, and go to that state.  Also,</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                    <span class="c1"># reset the &quot;found_sep&quot; flag, for the next time we get to</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                    <span class="c1"># this state.</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_start&quot;</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">FIELD_NAME</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>                    <span class="n">found_sep</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">FIELD_NAME</span><span class="p">:</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>                <span class="c1"># Try and find a separator - we ensure that, if we do, we only</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>                <span class="c1"># look for the equal sign before it.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                <span class="n">sep_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>                <span class="k">if</span> <span class="n">sep_pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>                    <span class="n">sep_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>                <span class="c1"># See if we can find an equals sign in the remaining data.  If</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                <span class="c1"># so, we can immediately emit the field name and jump to the</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                <span class="c1"># data state.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                <span class="k">if</span> <span class="n">sep_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                    <span class="n">equals_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sep_pos</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                    <span class="n">equals_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>                <span class="k">if</span> <span class="n">equals_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                    <span class="c1"># Emit this name.</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_name&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">equals_pos</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                    <span class="c1"># Jump i to this position.  Note that it will then have 1</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                    <span class="c1"># added to it below, which means the next iteration of this</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                    <span class="c1"># loop will inspect the character after the equals sign.</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">equals_pos</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">FIELD_DATA</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                    <span class="c1"># No equals sign found.</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">strict_parsing</span><span class="p">:</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                        <span class="c1"># See also comments in the QuerystringState.FIELD_DATA case below.</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                        <span class="c1"># If we found the separator, we emit the name and just</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                        <span class="c1"># end - there&#39;s no data callback at all (not even with</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                        <span class="c1"># a blank value).</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>                        <span class="k">if</span> <span class="n">sep_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_name&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sep_pos</span><span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                            <span class="n">i</span> <span class="o">=</span> <span class="n">sep_pos</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                            <span class="n">state</span> <span class="o">=</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">BEFORE_FIELD</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                            <span class="c1"># Otherwise, no separator in this block, so the</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                            <span class="c1"># rest of this chunk must be a name.</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_name&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>                            <span class="n">i</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                        <span class="c1"># We&#39;re parsing strictly.  If we find a separator,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                        <span class="c1"># this is an error - we require an equals sign.</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                        <span class="k">if</span> <span class="n">sep_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                            <span class="n">e</span> <span class="o">=</span> <span class="n">QuerystringParseError</span><span class="p">(</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                                <span class="s2">&quot;When strict_parsing is True, we require an &quot;</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>                                <span class="s2">&quot;equals sign in all field chunks. Did not &quot;</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>                                <span class="s2">&quot;find one in the chunk that starts at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                            <span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                            <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>                        <span class="c1"># No separator in the rest of this chunk, so it&#39;s just</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                        <span class="c1"># a field name.</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_name&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                        <span class="n">i</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">FIELD_DATA</span><span class="p">:</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>                <span class="c1"># Try finding either an ampersand or a semicolon after this</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>                <span class="c1"># position.</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>                <span class="n">sep_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                <span class="k">if</span> <span class="n">sep_pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>                    <span class="n">sep_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                <span class="c1"># If we found it, callback this bit as data and then go back</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                <span class="c1"># to expecting to find a field.</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                <span class="k">if</span> <span class="n">sep_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sep_pos</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                    <span class="c1"># Note that we go to the separator, which brings us to the</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                    <span class="c1"># &quot;before field&quot; state.  This allows us to properly emit</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>                    <span class="c1"># &quot;field_start&quot; events only when we actually have data for</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>                    <span class="c1"># a field of some sort.</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">sep_pos</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">BEFORE_FIELD</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>                <span class="c1"># Otherwise, emit the rest as data and finish.</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover (error case)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Reached an unknown state </span><span class="si">%d</span><span class="s2"> at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">QuerystringParseError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>                <span class="n">e</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>                <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_found_sep</span> <span class="o">=</span> <span class="n">found_sep</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finalize this parser, which signals to that we are finished parsing,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        if we&#39;re still in the middle of a field, an on_field_end callback, and</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">        then the on_end callback.</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="c1"># If we&#39;re currently in the middle of a field, we finish it.</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">FIELD_DATA</span><span class="p">:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(strict_parsing=</span><span class="si">{!r}</span><span class="s2">, max_size=</span><span class="si">{!r}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_parsing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h4 id="python_multipart.QuerystringParser-functions">Functions<a href="#python_multipart.QuerystringParser-functions" class="headerlink" title="Permanent link">&para;</a></h4>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.QuerystringParser.finalize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">finalize</span><span class="p">()</span></code>

<a href="#python_multipart.QuerystringParser.finalize" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Finalize this parser, which signals to that we are finished parsing,
if we're still in the middle of a field, an on_field_end callback, and
then the on_end callback.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Finalize this parser, which signals to that we are finished parsing,</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">    if we&#39;re still in the middle of a field, an on_field_end callback, and</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    then the on_end callback.</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>    <span class="c1"># If we&#39;re currently in the middle of a field, we finish it.</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">QuerystringState</span><span class="o">.</span><span class="n">FIELD_DATA</span><span class="p">:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;field_end&quot;</span><span class="p">)</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="python_multipart.QuerystringParser.write" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#python_multipart.QuerystringParser.write" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Write some data to the parser, which will perform size verification,
parse into either a field name or value, and then pass the
corresponding data to the underlying callback.  If an error is
encountered while parsing, a QuerystringParseError will be raised.  The
"offset" attribute of the raised exception will be set to the offset in
the input data chunk (NOT the overall stream) that caused the error.</p>
<p>Args:
    data: The data to write to the parser.</p>
<p>Returns:
    The number of bytes written.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write some data to the parser, which will perform size verification,</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">    parse into either a field name or value, and then pass the</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">    corresponding data to the underlying callback.  If an error is</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">    encountered while parsing, a QuerystringParseError will be raised.  The</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    &quot;offset&quot; attribute of the raised exception will be set to the offset in</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    the input data chunk (NOT the overall stream) that caused the error.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        data: The data to write to the parser.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        The number of bytes written.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="c1"># Handle sizing.</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+</span> <span class="n">data_len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="c1"># We truncate the length of data that we are to process.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="n">new_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">)</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>            <span class="s2">&quot;Current size is </span><span class="si">%d</span><span class="s2"> (max </span><span class="si">%d</span><span class="s2">), so truncating data length from </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span><span class="p">,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>            <span class="n">data_len</span><span class="p">,</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="n">new_size</span><span class="p">,</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="p">)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="n">data_len</span> <span class="o">=</span> <span class="n">new_size</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_len</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_size</span> <span class="o">+=</span> <span class="n">l</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>    <span class="k">return</span> <span class="n">l</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h2 id="python_multipart-functions">Functions<a href="#python_multipart-functions" class="headerlink" title="Permanent link">&para;</a></h2>

<div class="doc doc-object doc-function">


<h3 id="python_multipart.create_form_parser" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">create_form_parser</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">on_field</span><span class="p">,</span> <span class="n">on_file</span><span class="p">,</span> <span class="n">trust_x_headers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{})</span></code>

<a href="#python_multipart.create_form_parser" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>This function is a helper function to aid in creating a FormParser
instances.  Given a dictionary-like headers object, it will determine
the correct information needed, instantiate a FormParser with the
appropriate values and given callbacks, and then return the corresponding
parser.</p>
<p>Args:
    headers: A dictionary-like object of HTTP headers.  The only required header is Content-Type.
    on_field: Callback to call with each parsed field.
    on_file: Callback to call with each parsed file.
    trust_x_headers: Whether or not to trust information received from certain X-Headers - for example, the file
        name from X-File-Name.
    config: Configuration variables to pass to the FormParser.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1783" name="__codelineno-0-1783"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_form_parser</span><span class="p">(</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>    <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>    <span class="n">on_field</span><span class="p">:</span> <span class="n">OnFieldCallback</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>    <span class="n">on_file</span><span class="p">:</span> <span class="n">OnFileCallback</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>    <span class="n">trust_x_headers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FormParser</span><span class="p">:</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is a helper function to aid in creating a FormParser</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a><span class="sd">    instances.  Given a dictionary-like headers object, it will determine</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a><span class="sd">    the correct information needed, instantiate a FormParser with the</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a><span class="sd">    appropriate values and given callbacks, and then return the corresponding</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a><span class="sd">    parser.</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a><span class="sd">        headers: A dictionary-like object of HTTP headers.  The only required header is Content-Type.</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a><span class="sd">        on_field: Callback to call with each parsed field.</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a><span class="sd">        on_file: Callback to call with each parsed file.</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a><span class="sd">        trust_x_headers: Whether or not to trust information received from certain X-Headers - for example, the file</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a><span class="sd">            name from X-File-Name.</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a><span class="sd">        config: Configuration variables to pass to the FormParser.</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>    <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No Content-Type header given&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Content-Type header given!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>    <span class="c1"># Boundaries are optional (the FormParser will raise if one is needed</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>    <span class="c1"># but not given).</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>    <span class="n">content_type</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">parse_options_header</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>    <span class="n">boundary</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;boundary&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>    <span class="c1"># We need content_type to be a string, not a bytes object.</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>    <span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>    <span class="c1"># File names are optional.</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>    <span class="n">file_name</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-File-Name&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>    <span class="c1"># Instantiate a form parser.</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>    <span class="n">form_parser</span> <span class="o">=</span> <span class="n">FormParser</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="n">on_field</span><span class="p">,</span> <span class="n">on_file</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="n">boundary</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>    <span class="c1"># Return our parser.</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>    <span class="k">return</span> <span class="n">form_parser</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="python_multipart.parse_form" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">parse_form</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">input_stream</span><span class="p">,</span> <span class="n">on_field</span><span class="p">,</span> <span class="n">on_file</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1048576</span><span class="p">)</span></code>

<a href="#python_multipart.parse_form" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>This function is useful if you just want to parse a request body,
without too much work.  Pass it a dictionary-like object of the request's
headers, and a file-like object for the input stream, along with two
callbacks that will get called whenever a field or file is parsed.</p>
<p>Args:
    headers: A dictionary-like object of HTTP headers.  The only required header is Content-Type.
    input_stream: A file-like object that represents the request body. The read() method must return bytestrings.
    on_field: Callback to call with each parsed field.
    on_file: Callback to call with each parsed file.
    chunk_size: The maximum size to read from the input stream and write to the parser at one time.
        Defaults to 1 MiB.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>python_multipart/multipart.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1827" name="__codelineno-0-1827"></a><span class="k">def</span><span class="w"> </span><span class="nf">parse_form</span><span class="p">(</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>    <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>    <span class="n">input_stream</span><span class="p">:</span> <span class="n">SupportsRead</span><span class="p">,</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>    <span class="n">on_field</span><span class="p">:</span> <span class="n">OnFieldCallback</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>    <span class="n">on_file</span><span class="p">:</span> <span class="n">OnFileCallback</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1048576</span><span class="p">,</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is useful if you just want to parse a request body,</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a><span class="sd">    without too much work.  Pass it a dictionary-like object of the request&#39;s</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a><span class="sd">    headers, and a file-like object for the input stream, along with two</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a><span class="sd">    callbacks that will get called whenever a field or file is parsed.</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a><span class="sd">        headers: A dictionary-like object of HTTP headers.  The only required header is Content-Type.</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a><span class="sd">        input_stream: A file-like object that represents the request body. The read() method must return bytestrings.</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a><span class="sd">        on_field: Callback to call with each parsed field.</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a><span class="sd">        on_file: Callback to call with each parsed file.</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a><span class="sd">        chunk_size: The maximum size to read from the input stream and write to the parser at one time.</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a><span class="sd">            Defaults to 1 MiB.</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>    <span class="c1"># Create our form parser.</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">create_form_parser</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">on_field</span><span class="p">,</span> <span class="n">on_file</span><span class="p">)</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>    <span class="c1"># Read chunks of 1MiB and write to the parser, but never read more than</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>    <span class="c1"># the given Content-Length, if any.</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>    <span class="n">content_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>    <span class="k">if</span> <span class="n">content_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>        <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>        <span class="n">content_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>    <span class="n">bytes_read</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>        <span class="c1"># Read only up to the Content-Length given.</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>        <span class="n">max_readable</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">content_length</span> <span class="o">-</span> <span class="n">bytes_read</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">))</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>        <span class="n">buff</span> <span class="o">=</span> <span class="n">input_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">max_readable</span><span class="p">)</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>        <span class="c1"># Write to the parser and update our length.</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>        <span class="n">bytes_read</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="c1"># If we get a buffer that&#39;s smaller than the size requested, or if we</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>        <span class="c1"># have read up to our content length, we&#39;re done.</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span> <span class="o">!=</span> <span class="n">max_readable</span> <span class="ow">or</span> <span class="n">bytes_read</span> <span class="o">==</span> <span class="n">content_length</span><span class="p">:</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>            <span class="k">break</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>    <span class="c1"># Tell our parser that we&#39;re done writing data.</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="python_multipart.exceptions"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">







<h2 id="python_multipart.exceptions-classes">Classes<a href="#python_multipart.exceptions-classes" class="headerlink" title="Permanent link">&para;</a></h2>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.exceptions.DecodeError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>DecodeError</code>


<a href="#python_multipart.exceptions.DecodeError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;ParseError&lt;/code&gt; (&lt;code&gt;python_multipart.exceptions.ParseError&lt;/code&gt;)" href="#python_multipart.exceptions.ParseError">ParseError</a></code></p>



        <p>This exception is raised when there is a decoding error - for example
with the Base64Decoder or QuotedPrintableDecoder.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">class</span><span class="w"> </span><span class="nc">DecodeError</span><span class="p">(</span><span class="n">ParseError</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This exception is raised when there is a decoding error - for example</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    with the Base64Decoder or QuotedPrintableDecoder.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.exceptions.FileError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>FileError</code>


<a href="#python_multipart.exceptions.FileError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;FormParserError&lt;/code&gt; (&lt;code&gt;python_multipart.exceptions.FormParserError&lt;/code&gt;)" href="#python_multipart.exceptions.FormParserError">FormParserError</a></code>, <code><span title="OSError">OSError</span></code></p>



        <p>Exception class for problems with the File class.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">FileError</span><span class="p">(</span><span class="n">FormParserError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class for problems with the File class.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.exceptions.FormParserError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>FormParserError</code>


<a href="#python_multipart.exceptions.FormParserError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="ValueError">ValueError</span></code></p>



        <p>Base error class for our form parser.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">FormParserError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base error class for our form parser.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.exceptions.MultipartParseError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>MultipartParseError</code>


<a href="#python_multipart.exceptions.MultipartParseError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;ParseError&lt;/code&gt; (&lt;code&gt;python_multipart.exceptions.ParseError&lt;/code&gt;)" href="#python_multipart.exceptions.ParseError">ParseError</a></code></p>



        <p>This is a specific error that is raised when the MultipartParser detects
an error while parsing.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultipartParseError</span><span class="p">(</span><span class="n">ParseError</span><span class="p">):</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a specific error that is raised when the MultipartParser detects</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    an error while parsing.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.exceptions.ParseError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>ParseError</code>


<a href="#python_multipart.exceptions.ParseError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;FormParserError&lt;/code&gt; (&lt;code&gt;python_multipart.exceptions.FormParserError&lt;/code&gt;)" href="#python_multipart.exceptions.FormParserError">FormParserError</a></code></p>



        <p>This exception (or a subclass) is raised when there is an error while
parsing something.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">ParseError</span><span class="p">(</span><span class="n">FormParserError</span><span class="p">):</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This exception (or a subclass) is raised when there is an error while</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    parsing something.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="c1">#: This is the offset in the input data chunk (*NOT* the overall stream) in</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="c1">#: which the parse error occurred.  It will be -1 if not specified.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="python_multipart.exceptions.QuerystringParseError" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>QuerystringParseError</code>


<a href="#python_multipart.exceptions.QuerystringParseError" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;code&gt;ParseError&lt;/code&gt; (&lt;code&gt;python_multipart.exceptions.ParseError&lt;/code&gt;)" href="#python_multipart.exceptions.ParseError">ParseError</a></code></p>



        <p>This is a specific error that is raised when the QuerystringParser
detects an error while parsing.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>python_multipart/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">QuerystringParseError</span><span class="p">(</span><span class="n">ParseError</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a specific error that is raised when the QuerystringParser</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    detects an error while parsing.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/kludex/python-multipart" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/python-multipart" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tracking", "content.code.copy", "content.tooltips", "content.code.annotate", "navigation.sections"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>